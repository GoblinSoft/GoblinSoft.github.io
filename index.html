<!DOCTYPE html>
<style>
    div.border{
        border:1px solid black;
        width:50%;
        float:left;
        margin-bottom:-1px;
    }
    div.clearfloat{
        clear:left;
    }
    div.test{
        float:left;
        border:1px solid black;
        width:49%;
        margin-left:-1px;
    }
    div.vl{
        border-left:1px solid green;
        position:absolute;
        height:100%;
        left:50%;
    }
</style>
<html>
<head>
    <title>GoblinSoft Calculamator Alpha 69</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <script src="jquery-3.7.1.min.js"></script>
</head>
<body>
    <div class="border" id="player1">
    <label for="body">Body:</label>
    <input type="text" id="body"><br>
    <label for="mind">Mind:</label>
    <input type="text" id="mind"><br>
    <label for="soul">Soul:</label>
    <input type="text" id="soul"><br>
    <label for="wepspeed">Weapon Speed:</label>
    <input type="text" id="wepspeed"><br>
    <label for="wepdamage">Weapon Damage:</label>
    <input type="text" id="wepdamage"><br>
    <label for="wepspell">Weapon Spell:</label>
    <input type="text" id="wepspell"><br>
    <label for="prof">Profession Level:</label>
    <input type="text" id="prof"><br>
    <label for="racestart">Race:</label>
    <select name="racestart" id="racestart">
    <option value="human">Human</option>
    <option value="goblin">Goblin</option>
    <option value="none">None</option>
    </select><br>
    </div>
    <div class="test" id="player2" style="display:none;">
    <label for="body2">Body:</label>
    <input type="text" id="body2"><br>
    <label for="mind2">Mind:</label>
    <input type="text" id="mind2"><br>
    <label for="soul2">Soul:</label>
    <input type="text" id="soul2"><br>
    <label for="wepspeed2">Weapon Speed:</label>
    <input type="text" id="wepspeed2"><br>
    <label for="wepdamage2">Weapon Damage:</label>
    <input type="text" id="wepdamage2"><br>
    <label for="wepspell">Weapon Spell:</label>
    <input type="text" id="wepspell2"><br>
    <label for="prof2">Profession Level:</label>
    <input type="text" id="prof2"><br>
    <label for="racestart2">Race:</label>
    <select name="racestart2" id="racestart2">
    <option value="human2">Human</option>
    <option value="goblin2">Goblin</option>
    <option value="none2">None</option>
    </select><br>
    </div>
    <div class="clearfloat" id="results">
            <label for="player2">2P?</label>
        <select name="2p" id="2p" onchange="showDiv(this)">
        <option value="0" selected>No</option>
        <option value="1">Yes</option>
        </select><br>
        <button id="button" onclick="calculamate()">OK</button><br>
        <hr>
        <div class="vl" id="vl1" style="display:none;"></div>
        <p id="error"></p>
        <p id="level"></p>
        <p id="exp"></p>
        <p id="stamina"></p>
        <p id="strength"></p>
        <p id="agility"></p>
        <p id="intellect"></p>
        <p id="wisdom"></p>
        <p id="totalhealth"></p>
        <p id="totalmana"></p>
        <p id="baseattack"></p>
        <p id="modattack"></p>
        <p id="attackdam"></p>
        <p id="basespell"></p>
        <p id="modspell"></p>
        <p id="spelldam"></p>
        <p id="profbon"></p>
    </div>
</body>
<script>
    $(function(){
   document.getElementById("2p").value = 0;
});
</script>
<script type="text/javascript">
function showDiv(select){
   if(select.value==1){
    document.getElementById('vl1').style.display = "block";
    document.getElementById('player2').style.display = "inline-block";
   } else{
    document.getElementById('vl1').style.display = "none";
    document.getElementById('player2').style.display = "none";
   }
} 
</script>
<script>
function calculamate() {
  // Define acceptable characters for error handling
  const ErrorGoblin = /[^\d,km.]/;
  // Parse inputs as trimmed values
  const mindin = document.getElementById("mind").value.trim();
  const bodyin = document.getElementById("body").value.trim();
  const soulin = document.getElementById("soul").value.trim();
  const wspeedin = document.getElementById("wepspeed").value.trim();
  const wdamagein = document.getElementById("wepdamage").value.trim();
  const wspellin = document.getElementById("wepspell").value.trim();
  const profin = document.getElementById("prof").value.trim();
  // Capture race value from "racestart" dropdown as constant
  const racein = document.getElementById("racestart").value;
  // Constant for total level value calculation that utilizes parseNumber to clean up colloquial notation
  const blingoGob = parseNumber(mindin) + parseNumber(bodyin) + parseNumber(soulin) + parseNumber(profin);
  // Set for checking if any of the text inputs contain an empty string
  const blingoSet = new Set([mindin, bodyin, soulin, wspeedin, wdamagein, wspellin, profin]);
  // Check if any input contains illegal characters (gobs)
  const doesItGob = (value) => ErrorGoblin.test(value) && !isNaN(parseNumber(value)) || isNaN(parseNumber(value));
  // Check if inputs gob or contain an empty string
  if (doesItGob(mindin) || doesItGob(bodyin) || doesItGob(soulin) || doesItGob(wspeedin) || doesItGob(wdamagein) || doesItGob(wspellin) || doesItGob(profin) || blingoSet.has("")) { 

        // Output logic if input is found to gob by doesItGob(input)
        document.getElementById("error").innerHTML = "Error detected! There is a non-integer or special character.";
        document.getElementById("error").style.color = "red";
        document.getElementById("strength").innerHTML = "";
        document.getElementById("stamina").innerHTML = "";
        document.getElementById("agility").innerHTML = "";
        document.getElementById("intellect").innerHTML = "";
        document.getElementById("wisdom").innerHTML = "";
        document.getElementById("level").innerHTML = "";
        document.getElementById("exp").innerHTML = "";
        document.getElementById("totalhealth").innerHTML = "";
        document.getElementById("totalmana").innerHTML = "";
        document.getElementById("baseattack").innerHTML = "";
        document.getElementById("modattack").innerHTML = "";
        document.getElementById("attackdam").innerHTML = "";
        document.getElementById("basespell").innerHTML = "";
        document.getElementById("modspell").innerHTML = "";
        document.getElementById("spelldam").innerHTML = "";
        document.getElementById("profbon").innerHTML = "";

    } else if (blingoGob > 100) {

        // Output logic if level sum is above max
        document.getElementById("error").innerHTML = "Error detected! Goblins can only calculate levels up to 100.";
        document.getElementById("error").style.color = "red";
        document.getElementById("strength").innerHTML = "";
        document.getElementById("stamina").innerHTML = "";
        document.getElementById("agility").innerHTML = "";
        document.getElementById("intellect").innerHTML = "";
        document.getElementById("wisdom").innerHTML = "";
        document.getElementById("level").innerHTML = "Level: " + blingoGob.toLocaleString();
        document.getElementById("level").style.color = "red";
        document.getElementById("exp").innerHTML = "";
        document.getElementById("totalhealth").innerHTML = "";
        document.getElementById("totalmana").innerHTML = "";
        document.getElementById("baseattack").innerHTML = "";
        document.getElementById("modattack").innerHTML = "";
        document.getElementById("attackdam").innerHTML = "";
        document.getElementById("basespell").innerHTML = "";
        document.getElementById("modspell").innerHTML = "";
        document.getElementById("spelldam").innerHTML = "";
        document.getElementById("profbon").innerHTML = "";

    } else {

        // Input constants utilizing parseNumber for colloquial notation cleaning and calculation purposes
        const mind = parseNumber(mindin);
        const body = parseNumber(bodyin);
        const soul = parseNumber(soulin);
        const speed = parseNumber(wspeedin);
        const damage = parseNumber(wdamagein);
        const wepdamage = parseNumber (wspellin);
        const prof = parseNumber(profin);
        // Level and allstat multipliers
        const level = mind + body + soul + prof;
        var xp = (level * level * level) * (1 + (0.02 * level));
        const soulcon = (1 + (0.03 * level)) * soul;
        const profbonus = (0.7 + (0.02 * level)) * prof;
        // Check race and apply appropriate modifiers
        if (racein == "human") {
            var racebonus = (3 + (0.3 + (0.007 * level)) * level);
        } else if (racein == "goblin") {
            var racebonus = (122 + (0.02 * level)) * prof;
        } else {
            var racebonus = 0;
        }
        // Stat formulas
        const stamina = (0.5 + (0.015 * level)) * (mind + body) + soulcon + profbonus + racebonus;
        const strength = (1.5 + (0.05 * level)) * body + soulcon + profbonus + racebonus;
        const agility = (0.5 + (0.015 * level)) * body + soulcon + profbonus + racebonus;
        const wisdom = (0.5 + (0.015 * level)) * mind + soulcon + profbonus + racebonus;
        const intellect = (1.5 + (0.05 * level)) * mind + soulcon + profbonus + racebonus;
        const basehealth = (0.15 * level + 14) * level * (1 + 0.011 * soul);
        const totalhealth = basehealth + (5 * stamina);
        const basemana = (0.008 * level + 7) * level * (1 + 0.015 * mind);
        const totalmana = basemana + (5 * wisdom);
        // Attack and spell formulas
        const bAD = (0.4 + 0.002 * level) * level + (0.06 * strength);
        const mAD = (bAD) * (1 + (0.05 * body)) * (0.41 * speed);
        const atdam = (mAD + damage) + (0.22 * agility);
        const bSP = (0.5 + 0.0026 * level) * level + (0.18 * intellect);
        const mSP = (bSP) * (1 + (0.05 * mind)) * (0.41 * speed);
        const spdam = (mSP + wepdamage) + (0.38 * wisdom);

        // Output logic for fully parsable result
        document.getElementById("error").innerHTML = "";
        document.getElementById("strength").innerHTML = "Strength: " + Math.round(strength.toLocaleString()) + " (" + strength.toFixed(2).toLocaleString() + ")";
        document.getElementById("strength").style.color = "black";
        document.getElementById("stamina").innerHTML = "Stamina: " + Math.round(stamina.toLocaleString()) + " (" + stamina.toFixed(2).toLocaleString() + ")";
        document.getElementById("stamina").style.color = "black";
        document.getElementById("agility").innerHTML = "Agility: " + Math.round(agility.toLocaleString()) + " (" + agility.toFixed(2).toLocaleString() + ")";
        document.getElementById("agility").style.color = "black";
        document.getElementById("intellect").innerHTML = "Intellect: " + Math.round(intellect.toLocaleString()) + " (" + intellect.toFixed(2).toLocaleString() + ")";
        document.getElementById("intellect").style.color = "black";
        document.getElementById("wisdom").innerHTML = "Wisdom: " + Math.round(wisdom.toLocaleString()) + " (" + wisdom.toFixed(2).toLocaleString() + ")";
        document.getElementById("wisdom").style.color = "black";
        document.getElementById("level").innerHTML = "Level: " + level.toLocaleString();
        document.getElementById("level").style.color = "black";
        document.getElementById("exp").innerHTML = "Experience: " + Math.round(xp).toLocaleString() + " (" + xp.toFixed(2).toLocaleString() + ")";
        document.getElementById("exp").style.color = "black";
        document.getElementById("totalhealth").innerHTML = "Total Health: " + Math.round(totalhealth).toLocaleString() + " (" + totalhealth.toFixed(2).toLocaleString() + ")";
        document.getElementById("totalhealth").style.color = "green";
        document.getElementById("totalmana").innerHTML = "Total Mana: " + Math.round(totalmana).toLocaleString() + " (" + totalmana.toFixed(2).toLocaleString() + ")";
        document.getElementById("totalmana").style.color = "blue";
        document.getElementById("baseattack").innerHTML = "Base Attack Damage (bAD): " + Math.round(bAD).toLocaleString() + " (" + bAD.toFixed(3) + ")";
        document.getElementById("baseattack").style.color = "red";
        document.getElementById("modattack").innerHTML = "Modified Attack Damage (mAD): " + Math.round(mAD).toLocaleString() + " (" + mAD.toFixed(3) + ")";
        document.getElementById("modattack").style.color = "red";
        document.getElementById("attackdam").innerHTML = "Attack Damage (AD): " + Math.round(atdam).toLocaleString() + " (" + atdam.toFixed(3) + ")";
        document.getElementById("attackdam").style.color = "red";
        document.getElementById("basespell").innerHTML = "Base Spell Damage (bSP): " + Math.round(bSP).toLocaleString() + " (" + bSP.toFixed(3) + ")";
        document.getElementById("basespell").style.color = "blue";
        document.getElementById("modspell").innerHTML = "Modified Spell Damage (mSP): " + Math.round(mSP).toLocaleString() + " (" + mSP.toFixed(3) + ")";
        document.getElementById("modspell").style.color = "blue";
        document.getElementById("spelldam").innerHTML = "Spell Damage (SP): " + Math.round(spdam).toLocaleString() + " (" + spdam.toFixed(3) + ")";
        document.getElementById("spelldam").style.color = "blue";
        document.getElementById("profbon").innerHTML = "Profession Bonus: " + Math.round(profbonus).toLocaleString() + " (" + profbonus.toFixed(3) + ")";
        document.getElementById("profbon").style.color = "aquamarine";

    }
}

// Function to accept things like "k" and "m" as multipliers and parse the returned value as a float
function parseNumber(value) {
    const multipliers = {
        k: 1000,
        m: 1000000,
    };

    // Removes commas from user input (if any) for calculation purposes
    value = value.replace(/,/g, "");

    // Check for multiplier -- only works with flat 100k, 100m and not combinations like 100m100k
    const match = value.match(/(\d+(\.+\d+)?)([km])/i);

  if (match) {
    const number = parseFloat(match[1]);
    let multiplier = 1;
    if (match[3]) multiplier *= multipliers[match[3].toLowerCase()];
    return number * multiplier;
  }

  return parseFloat(value);
}

// EventListener to allow user to press Enter key anywhere on page for form submission
window.addEventListener("keydown", checkEnter, false)
function checkEnter(event) {
    if (event.keyCode == 13) {
    document.getElementById("button").click();
    }
}

</script>
</html>