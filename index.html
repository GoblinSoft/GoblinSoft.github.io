<!DOCTYPE html>
<html>
<head>
    <title>GoblinSoft Calculamator Alpha 5</title>
</head>
<body>
    <label for="level">Level:</label>
    <input type="text" id="level"><br>
    <label for="body">Body:</label>
    <input type="text" id="body"><br>
    <label for="mind">Mind:</label>
    <input type="text" id="mind"><br>
    <label for="spirit">Spirit:</label>
    <input type="text" id="spirit"><br>
    <hr>
    <div id="results">
        <p id="error"></p>
        <p id="damage"></p>
        <p id="leveltotal"></p>
    </div>
    <button onclick="calculamate()">OK</button>
</body>
<script>

function calculamate() {
  const ErrorGoblin = /[^\d,km.]/;
  const bodyin = document.getElementById("body").value;
  const mindin = document.getElementById("mind").value;
  const spiritin = document.getElementById("spirit").value;
  const levelin = document.getElementById("level").value;

  // Function checks if given values are valid
  const doesItGob = (value) => ErrorGoblin.test(value) && !isNaN(parseNumber(value));

  if (doesItGob(bodyin) || doesItGob(mindin) || doesItGob(spiritin) || doesItGob(levelin)) { 

        // Error handling
        // Check to see if it doesn't fit True for both parameters of doesItGob
        document.getElementById("error").innerHTML = "Error detected! There is a non-integer or special character.";
        document.getElementById("error").style.color = "red";
        document.getElementById("damage").innerHTML = "";
    } else {

        // Print damage formula if no issues, first defining parses variables 
        const body = parseNumber(bodyin);
        const mind = parseNumber(mindin);
        const spirit = parseNumber(spiritin);
        const level = parseNumber(levelin);
        const totallevel = mind + body + spirit + level;

        // The formula/e proper
        var damage = (body * mind) * spirit * 0.10 * (0.025 * level) * totallevel; 

        // User-displayed output handling for "damage" return
        document.getElementById("error").innerHTML = "";
        document.getElementById("damage").innerHTML = "Damage: " + damage.toLocaleString();
        document.getElementById("damage").style.color = "black";
        document.getElementById("leveltotal").innerHTML = "Total Level: " + totallevel.toLocaleString();
        document.getElementById("leveltotal").style.color = "black";
    }
}

function parseNumber(value) {
    const multipliers = {
        k: 1000,
        m: 1000000,
    };

    // Removes commas from user input (if any) for calculation purposes
    value = value.replace(/,/g, "");

    // Check for multiplier -- only works with flat 100k, 100m and not combinations like 100m100k
    const match = value.match(/(\d+(\.+\d+)?)([km])/i);

  if (match) {
    const number = parseFloat(match[1]);
    let multiplier = 1;
    if (match[3]) multiplier *= multipliers[match[3].toLowerCase()];
    return number * multiplier;
  }

  return parseFloat(value);
}

</script>
</html>