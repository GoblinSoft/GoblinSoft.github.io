<!DOCTYPE html>
<html>
<head>
    <title>GoblinSoft Calculamator Alpha 7</title>
</head>
<body>
    <label for="body">Body:</label>
    <input type="text" id="body"><br>
    <label for="mind">Mind:</label>
    <input type="text" id="mind"><br>
    <label for="soul">Soul:</label>
    <input type="text" id="soul"><br>
    <hr>
    <div id="results">
        <p id="error"></p>
        <p id="level"></p>
        <p id="stamina"></p>
        <p id="strength"></p>
        <p id="agility"></p>
        <p id="intellect"></p>
        <p id="wisdom"></p>
        <p id="totalhealth"></p>
        <p id="totalmana"></p>
    </div>
    <button onclick="calculamate()">OK</button>
</body>
<script>

function calculamate() {
  const ErrorGoblin = /[^\d,km.]/;
  const mindin = document.getElementById("mind").value;
  const bodyin = document.getElementById("body").value;
  const soulin = document.getElementById("soul").value;

  // Function checks if given values are valid
  const doesItGob = (value) => ErrorGoblin.test(value) && !isNaN(parseNumber(value));

  if (doesItGob(mindin) || doesItGob(bodyin) || doesItGob(soulin)) { 

        // Error handling
        // Check to see if it doesn't fit True for both parameters of doesItGob
        document.getElementById("error").innerHTML = "Error detected! There is a non-integer or special character.";
        document.getElementById("error").style.color = "red";
    } else {

        // Print damage formula if no issues, first defining parses variables 
        const mind = parseNumber(mindin);
        const body = parseNumber(bodyin);
        const soul = parseNumber(soulin);
        const level = mind + body + soul;
        const soulcon = (1 + (0.03 * level)) * soul; // r
        const stamina = (0.5 + (0.015 * level)) * (mind + body) + soulcon; // r
        const strength = (1.5 + (0.05 * level)) * body + soulcon;  // r
        const agility = (0.5 + (0.015 * level)) * body + soulcon;
        const wisdom = (0.5 + (0.015 * level)) * mind + soulcon;
        const intellect = (1.5 + (0.05 * level)) * mind + soulcon;
        const basehealth = (0.15 * level + 10) * level * (1 + 0.015 * soul);
        const totalhealth = basehealth + (5 * stamina);
        const basemana = (0.008 * level + 7) * level * (1 + 0.015 * mind);
        const totalmana = basemana + (5 * wisdom);

        // The formula/e proper
        var stamshow = stamina;

        // User-displayed output handling for "damage" return
        document.getElementById("error").innerHTML = "";
        document.getElementById("strength").innerHTML = "Strength: " + strength.toLocaleString();
        document.getElementById("strength").style.color = "black";
        document.getElementById("stamina").innerHTML = "Stamina: " + stamina.toLocaleString();
        document.getElementById("stamina").style.color = "black";
        document.getElementById("agility").innerHTML = "Agility: " + agility.toLocaleString();
        document.getElementById("agility").style.color = "black";
        document.getElementById("intellect").innerHTML = "Intellect: " + intellect.toLocaleString();
        document.getElementById("intellect").style.color = "black";
        document.getElementById("wisdom").innerHTML = "Wisdom: " + wisdom.toLocaleString();
        document.getElementById("wisdom").style.color = "black";
        document.getElementById("level").innerHTML = "Level: " + level.toLocaleString();
        document.getElementById("level").style.color = "black";
        document.getElementById("totalhealth").innerHTML = "Total Health: " + totalhealth.toLocaleString();
        document.getElementById("totalhealth").style.color = "green";
        document.getElementById("totalmana").innerHTML = "Total Mana: " + totalmana.toLocaleString();
        document.getElementById("totalmana").style.color = "blue";

    }
}

function parseNumber(value) {
    const multipliers = {
        k: 1000,
        m: 1000000,
    };

    // Removes commas from user input (if any) for calculation purposes
    value = value.replace(/,/g, "");

    // Check for multiplier -- only works with flat 100k, 100m and not combinations like 100m100k
    const match = value.match(/(\d+(\.+\d+)?)([km])/i);

  if (match) {
    const number = parseFloat(match[1]);
    let multiplier = 1;
    if (match[3]) multiplier *= multipliers[match[3].toLowerCase()];
    return number * multiplier;
  }

  return parseFloat(value);
}

</script>
</html>