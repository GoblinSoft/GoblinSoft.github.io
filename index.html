<!DOCTYPE html>
<html>
<head>
    <title>GoblinSoft Calculamator Alpha 63</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <label for="body">Body:</label>
    <input type="text" id="body"><br>
    <label for="mind">Mind:</label>
    <input type="text" id="mind"><br>
    <label for="soul">Soul:</label>
    <input type="text" id="soul"><br>
    <label for="wepspeed">Weapon Speed:</label>
    <input type="text" id="wepspeed"><br>
    <label for="wepdamage">Weapon Damage:</label>
    <input type="text" id="wepdamage"><br>
    <label for="wepspell">Weapon Spell:</label>
    <input type="text" id="wepspell"><br>
    <label for="prof">Profession Level:</label>
    <input type="text" id="prof"><br>
    <label for="racestart">Race:</label>
    <select name="racestart" id="racestart">
    <option value="human">Human</option>
    <option value="goblin">Goblin</option>
    <option value="none">None</option>
    </select>
    <hr>
    <div id="results">
        <button onclick="calculamate()">OK</button><br>
        <p id="error"></p>
        <p id="level"></p>
        <p id="exp"></p>
        <p id="stamina"></p>
        <p id="strength"></p>
        <p id="agility"></p>
        <p id="intellect"></p>
        <p id="wisdom"></p>
        <p id="totalhealth"></p>
        <p id="totalmana"></p>
        <p id="baseattack"></p>
        <p id="modattack"></p>
        <p id="attackdam"></p>
        <p id="basespell"></p>
        <p id="modspell"></p>
        <p id="spelldam"></p>
        <p id="profbon"></p>
    </div>
</body>
<script>

function calculamate() {
  const ErrorGoblin = /[^\d,km.]/;
  const mindin = document.getElementById("mind").value.trim();
  const bodyin = document.getElementById("body").value.trim();
  const soulin = document.getElementById("soul").value.trim();
  const wspeedin = document.getElementById("wepspeed").value.trim();
  const wdamagein = document.getElementById("wepdamage").value.trim();
  const wspellin = document.getElementById("wepspell").value.trim();
  const profin = document.getElementById("prof").value.trim();
  const racein = document.getElementById("racestart").value;
  const blingoGob = parseNumber(mindin) + parseNumber(bodyin) + parseNumber(soulin) + parseNumber(profin);
  const blingoSet = new Set([mindin, bodyin, soulin, wspeedin, wdamagein, wspellin, profin]);

  // Check if input contains illegal characters
  const doesItGob = (value) => ErrorGoblin.test(value) && !isNaN(parseNumber(value)) || isNaN(parseNumber(value));

  if (doesItGob(mindin) || doesItGob(bodyin) || doesItGob(soulin) || doesItGob(wspeedin) || doesItGob(wdamagein) || doesItGob(wspellin) || doesItGob(profin) || blingoSet.has("")) { 

        // Output logic (illegal character)
        document.getElementById("error").innerHTML = "Error detected! There is a non-integer or special character.";
        document.getElementById("error").style.color = "red";
        document.getElementById("strength").innerHTML = "";
        document.getElementById("stamina").innerHTML = "";
        document.getElementById("agility").innerHTML = "";
        document.getElementById("intellect").innerHTML = "";
        document.getElementById("wisdom").innerHTML = "";
        document.getElementById("level").innerHTML = "";
        document.getElementById("exp").innerHTML = "";
        document.getElementById("totalhealth").innerHTML = "";
        document.getElementById("totalmana").innerHTML = "";
        document.getElementById("baseattack").innerHTML = "";
        document.getElementById("modattack").innerHTML = "";
        document.getElementById("attackdam").innerHTML = "";
        document.getElementById("basespell").innerHTML = "";
        document.getElementById("modspell").innerHTML = "";
        document.getElementById("spelldam").innerHTML = "";
        document.getElementById("profbon").innerHTML = "";
    } else if (blingoGob > 100) {

        // Output logic (Level's too high)
        document.getElementById("error").innerHTML = "Error detected! Goblins can only calculate levels up to 100.";
        document.getElementById("error").style.color = "red";
        document.getElementById("strength").innerHTML = "";
        document.getElementById("stamina").innerHTML = "";
        document.getElementById("agility").innerHTML = "";
        document.getElementById("intellect").innerHTML = "";
        document.getElementById("wisdom").innerHTML = "";
        document.getElementById("level").innerHTML = "Level: " + blingoGob.toLocaleString();
        document.getElementById("level").style.color = "red";
        document.getElementById("exp").innerHTML = "Experience: " + exp.toLcaleString();
        document.getElementById("totalhealth").innerHTML = "";
        document.getElementById("totalmana").innerHTML = "";
        document.getElementById("baseattack").innerHTML = "";
        document.getElementById("modattack").innerHTML = "";
        document.getElementById("attackdam").innerHTML = "";
        document.getElementById("basespell").innerHTML = "";
        document.getElementById("modspell").innerHTML = "";
        document.getElementById("spelldam").innerHTML = "";
        document.getElementById("profbon").innerHTML = "";
    } else {

        // Output logic (True)
        const mind = parseNumber(mindin);
        const body = parseNumber(bodyin);
        const soul = parseNumber(soulin);
        const speed = parseNumber(wspeedin);
        const damage = parseNumber(wdamagein);
        const wepdamage = parseNumber (wspellin);
        const prof = parseNumber(profin);
        const level = mind + body + soul + prof;
        var xp = (level * level * level) * (1 + (0.02 * level));
        const soulcon = (1 + (0.03 * level)) * soul;
        const profbonus = (0.7 + (0.02 * level)) * prof;
        if (racein == "human") {
            var racebonus = (3 + (0.3 + (0.007 * level)) * level);
        } else if (racein == "goblin") {
            var racebonus = (122 + (0.02 * level)) * prof;
        } else {
            var racebonus = 0;
        }
        console.log(racein)        
        const stamina = (0.5 + (0.015 * level)) * (mind + body) + soulcon + profbonus + racebonus;
        const strength = (1.5 + (0.05 * level)) * body + soulcon + profbonus + racebonus;
        const agility = (0.5 + (0.015 * level)) * body + soulcon + profbonus + racebonus;
        const wisdom = (0.5 + (0.015 * level)) * mind + soulcon + profbonus + racebonus;
        const intellect = (1.5 + (0.05 * level)) * mind + soulcon + profbonus + racebonus;
        const basehealth = (0.15 * level + 14) * level * (1 + 0.011 * soul);
        const totalhealth = basehealth + (5 * stamina);
        const basemana = (0.008 * level + 7) * level * (1 + 0.015 * mind);
        const totalmana = basemana + (5 * wisdom);
        const bAD = (0.4 + 0.004 * level) * level + (0.12 * strength);
        const mAD = (bAD) * (1 + (0.05 * body)) * (0.45 * speed);
        const atdam = (mAD + damage) + (0.28 * agility);
        const bSP = (0.5 + 0.005 * level) * level + (0.18 * intellect);
        const mSP = (bSP) * (1 + (0.05 * mind)) * (0.45 * speed);
        const spdam = (mSP + wepdamage) + (0.38 * wisdom);

        document.getElementById("error").innerHTML = "";
        document.getElementById("strength").innerHTML = "Strength: " + Math.round(strength.toLocaleString()) + " (" + strength.toFixed(2).toLocaleString() + ")";
        document.getElementById("strength").style.color = "black";
        document.getElementById("stamina").innerHTML = "Stamina: " + Math.round(stamina.toLocaleString()) + " (" + stamina.toFixed(2).toLocaleString() + ")";
        document.getElementById("stamina").style.color = "black";
        document.getElementById("agility").innerHTML = "Agility: " + Math.round(agility.toLocaleString()) + " (" + agility.toFixed(2).toLocaleString() + ")";
        document.getElementById("agility").style.color = "black";
        document.getElementById("intellect").innerHTML = "Intellect: " + Math.round(intellect.toLocaleString()) + " (" + intellect.toFixed(2).toLocaleString() + ")";
        document.getElementById("intellect").style.color = "black";
        document.getElementById("wisdom").innerHTML = "Wisdom: " + Math.round(wisdom.toLocaleString()) + " (" + wisdom.toFixed(2).toLocaleString() + ")";
        document.getElementById("wisdom").style.color = "black";
        document.getElementById("level").innerHTML = "Level: " + level.toLocaleString();
        document.getElementById("level").style.color = "black";
        document.getElementById("exp").innerHTML = "Experience: " + Math.round(xp).toLocaleString() + " (" + xp.toFixed(2).toLocaleString() + ")";
        document.getElementById("exp").style.color = "black";
        document.getElementById("totalhealth").innerHTML = "Total Health: " + Math.round(totalhealth).toLocaleString() + " (" + totalhealth.toFixed(2).toLocaleString() + ")";
        document.getElementById("totalhealth").style.color = "green";
        document.getElementById("totalmana").innerHTML = "Total Mana: " + Math.round(totalmana).toLocaleString() + " (" + totalmana.toFixed(2).toLocaleString() + ")";
        document.getElementById("totalmana").style.color = "blue";
        document.getElementById("baseattack").innerHTML = "Base Attack Damage (bAD): " + Math.round(bAD).toLocaleString() + " (" + bAD.toFixed(3) + ")";
        document.getElementById("baseattack").style.color = "red";
        document.getElementById("modattack").innerHTML = "Modified Attack Damage (mAD): " + Math.round(mAD).toLocaleString() + " (" + mAD.toFixed(3) + ")";
        document.getElementById("modattack").style.color = "red";
        document.getElementById("attackdam").innerHTML = "Attack Damage (AD): " + Math.round(atdam).toLocaleString() + " (" + atdam.toFixed(3) + ")";
        document.getElementById("attackdam").style.color = "red";
        document.getElementById("basespell").innerHTML = "Base Spell Damage (bSP): " + Math.round(bSP).toLocaleString() + " (" + bSP.toFixed(3) + ")";
        document.getElementById("basespell").style.color = "blue";
        document.getElementById("modspell").innerHTML = "Modified Spell Damage (mSP): " + Math.round(mSP).toLocaleString() + " (" + mSP.toFixed(3) + ")";
        document.getElementById("modspell").style.color = "blue";
        document.getElementById("spelldam").innerHTML = "Spell Damage (SP): " + Math.round(spdam).toLocaleString() + " (" + spdam.toFixed(3) + ")";
        document.getElementById("spelldam").style.color = "blue";
        document.getElementById("profbon").innerHTML = "Profession Bonus: " + Math.round(profbonus).toLocaleString() + " (" + profbonus.toFixed(3) + ")";
        document.getElementById("profbon").style.color = "aquamarine";

    }
}

function parseNumber(value) {
    const multipliers = {
        k: 1000,
        m: 1000000,
    };

    // Removes commas from user input (if any) for calculation purposes
    value = value.replace(/,/g, "");

    // Check for multiplier -- only works with flat 100k, 100m and not combinations like 100m100k
    const match = value.match(/(\d+(\.+\d+)?)([km])/i);

  if (match) {
    const number = parseFloat(match[1]);
    let multiplier = 1;
    if (match[3]) multiplier *= multipliers[match[3].toLowerCase()];
    return number * multiplier;
  }

  return parseFloat(value);
}

</script>
</html>